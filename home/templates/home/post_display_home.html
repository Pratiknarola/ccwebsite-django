{% load static %}
{% load materializecss %}
{% comment %}
    Context Variables:
    form - Signup form
    user - Logged in User
    addpostform - Post Add Form
    posts - Posts
    tags - Tags
    user_profiles - Profiles of users
    comments -
    comment_form - Comment Form
{% endcomment %}
{% if posts %}
    {# Pinned Posts #}
<div class="pinned-posts">
    {% for post in posts %}
        {% if post.is_pinned %}
            <ul class="collection with-header" >
                <li class="collection-header">
                    <h4 id="title-{{ post.pk }}" class="hide-on-med-and-down post-head-m-down">{{ post.title|safe }}<a class="chip">Pinned to Top</a> </h4>
                    <h4 id="title-{{ post.pk }}" class="hide-on-small-and-down hide-on-large-only post-head-s-down-l">{{ post.title|safe }}<a class="chip">Pinned to Top</a></h4>
                    <h4 id="title-{{ post.pk }}" class="hide-on-med-and-up post-head-m-up">{{ post.title|safe }}<a class="chip">Pinned to Top</a></h4>
                    <p class="row">
                        <span class="col s8 m8 l7">
                            <a class="chip" href="{% url 'User Profile' post.author.username %} ">
                                {% for user_profile in user_profiles %}
                                    {% if user_profile.user == post.author %}
                                        {% if user_profile.avatar %}
                                            <img src="{{ user_profile.avatar.url }}">
                                        {% else %}
                                            <img src="{% static 'default-profile-picture.jpg' %}">
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                                {{ post.author }}
                            </a>
                        </span>
                        <span class="col s4 m4 l4">{{ post.published|timesince }} ago.</span>
                    </p>
                </li>
                <li class="collection-item">
                    Tags :
                    {% for post_tag in post.tags.all %}
                        <a class="chip">{{ post_tag|safe }}</a>
                    {% endfor %}
                </li>
                <li class="collection-item" id="p">
    {#                <div class="less-content">#}
    {#                    {{ postpost_content|safe|truncatewords:50 }}#}
    {#                    <a class="read-more-btn" href="#">Show more</a>#}
    {#                </div>#}

                    <div class="expanded-content">
                        {{ post.post_content|safe }}
    {#                    <a class="read-less-btn" href="#">Show less</a>#}
                    </div>
                </li>
                <li class="collection-item row" id="like-{{ post.pk }}">
                    <div class="col s6 m6 l6 center">
    {#                    <a class="btn-flat col s5 m5 l5" href="{{ post.get_like_url }}">Like</a>LIKES:{{ post.likes.count }}#}
                        <a class="btn-flat like-btn light-blue white-text" data-href="{% url 'like_api_toggle' post.slug %}" data-likes="{{ post.likes.count }}" href="{% url 'like_toggle' post.slug %}">
                            <i class="material-icons">thumb_up</i>
                            {{ post.likes.count }} Like
                        </a>
    {#                    <a class="btn-flat disabled">LIKES:{{ post.likes.count }}</a>#}
                    </div>
                    <div class="col s6 m6 l6 center">
                        <a class="btn-flat comment-display-btn light-blue white-text" href="#"><i class="material-icons">comment</i></a>
                    </div>
                </li>
                <li class="collection-item comment-display" > {# style="display: none;"> #}
                        {% if user.is_authenticated %}
                            <form method="post" action="{% url 'Add Comment' post.id %}">
                                {% csrf_token %}
                                {{ comment_form|materializecss }}
                                <button class="btn waves-light" type="submit" name="action">Post Comment
                                    <i class="material-icons right">send</i>
                                </button>
                            </form>
                        {% endif %}
                            {% for comment in comments %}
                                {% if comment.post.id == post.id %}
                                    <blockquote id="comment-{{ post.pk }}-{{ comment.pk }}">
                                    {{ comment.comment_text }}
                                        <footer>
                                        via -
                                            <a class="chip" href="{% url 'User Profile' comment.user.username %} ">
                                                {% for user_profile in user_profiles %}
                                                    {% if user_profile.user == comment.user %}
                                                        {% if user_profile.avatar %}
                                                            <img src="{{ user_profile.avatar.url }}">
                                                        {% else %}
                                                            <img src="{% static 'default-profile-picture.jpg' %}">
                                                        {% endif %}
                                                    {% endif %}
                                                {% endfor %}
                                                {{ comment.user }}
                                            </a>
        {#                                    <span id="comment-timestamp" style="color: #0f74a8;">#}
                                                | {{ comment.timestamp|timesince }} ago |
                                                {% if comment.children.count > 1 %}
                                                    {{ comment.children.count }} Replies |
                                                {% elif comment.children.count == 1 %}
                                                    {{ comment.children.count }} Reply |
                                                {% endif %}
                                                <a class="comment-reply-btn" href="#">Reply</a>
        {#                                    </span>#}
                                        </footer>

                                        <div class="comment-reply" style="display: none;">
                                            {% for child_comment in comment.children %}
                                                <blockquote>
                                                {{ child_comment.comment_text }}
                                                    <footer>
                                                    via -
                                                        <a class="chip" href="{% url 'User Profile' child_comment.user.username %} ">
                                                            {% for user_profile in user_profiles %}
                                                                {% if user_profile.user == child_comment.user %}
                                                                    {% if user_profile.avatar %}
                                                                        <img src="{{ user_profile.avatar.url }}">
                                                                    {% else %}
                                                                        <img src="{% static 'default-profile-picture.jpg' %}">
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% endfor %}
                                                            {{ child_comment.user }}
                                                        </a>
                                                        <span id="comment-timestamp" style="color: #0f74a8;">
                                                            | {{ child_comment.timestamp|timesince }} ago
                                                        </span>
                                                    </footer>

                                                </blockquote>
                                            {% endfor %}
                                            {% if user.is_authenticated %}
                                                <form method="post" action="{% url 'Add Comment' post.id %}">
                                                    {% csrf_token %}
                                                    {{ comment_form|materializecss }}
                                                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                                                    <button class="btn waves-light" type="submit" name="action">Reply
                                                        <i class="material-icons right">send</i>
                                                    </button>
                                                </form>
                                            {% endif %}
                                        </div>
                                    </blockquote>
                                    <div class="divider"></div>
                                {% endif %}
                            {% endfor %}
                </li>
        {#      <li class="collection-item">#}
        {#      Share to:#}
        {#      <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}">Facebook</a>#}
        {#      </li>#}
            </ul>
        {% endif %}
    {% endfor %}
</div>
    {# Normal Posts #}
<div class="normal-posts">
    {% for post in posts %}
        {% if post.is_pinned is False %}
            <ul class="collection with-header" id="home-post-{{ post.pk }}">
                <li class="collection-header">
                    <h4 id="title-{{ post.pk }}" class="hide-on-med-and-down post-head-m-down">{{ post.title|safe }}</h4>
                    <h4 id="title-{{ post.pk }}" class="hide-on-small-and-down hide-on-large-only post-head-s-down-l">{{ post.title|safe }}</h4>
                    <h4 id="title-{{ post.pk }}" class="hide-on-med-and-up post-head-m-up">{{ post.title|safe }}</h4>
                    <p class="row">
                        <span class="col s8 m8 l7">
                            <a class="chip" href="{% url 'User Profile' post.author.username %} ">
                                {% for user_profile in user_profiles %}
                                    {% if user_profile.user == post.author %}
                                        {% if user_profile.avatar %}
                                            <img src="{{ user_profile.avatar.url }}">
                                        {% else %}
                                            <img src="{% static 'default-profile-picture.jpg' %}">
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                                {{ post.author }}
                            </a>
                        </span>
                        <span class="col s4 m4 l4">{{ post.published|timesince }} ago.</span>
                    </p>
                </li>
                <li class="collection-item">
                    Tags :
                    {% for post_tag in post.tags.all %}
                        <a class="chip">{{ post_tag|safe }}</a>
                    {% endfor %}
                </li>
                <li class="collection-item" id="p">
    {#                <div class="less-content">#}
    {#                    {{ postpost_content|safe|truncatewords:50 }}#}
    {#                    <a class="read-more-btn" href="#">Show more</a>#}
    {#                </div>#}

                    <div class="expanded-content">
                        {{ post.post_content|safe }}
    {#                    <a class="read-less-btn" href="#">Show less</a>#}
                    </div>
                </li>
                <li class="collection-item row" id="like-{{ post.pk }}">
                    {% if user == post.author %}
                        <div class="col s4 m4 l4 center">
                            <a class="btn-flat like-btn light-blue white-text" data-href="{% url 'like_api_toggle' post.slug %}" data-likes="{{ post.likes.count }}" href="{% url 'like_toggle' post.slug %}">
                                {{ post.likes.count }}
                                <i class="material-icons large">thumb_up</i>
                            </a>
                        </div>
                        <div class="col s4 m4 l4 center">
                            <a class="btn-flat comment-display-btn light-blue white-text" href="#">
                                <i class="material-icons large">comment</i>
                            </a>
                        </div>


                        <form action="{% url 'ajax_delete_post' %}" class="post-del-form" method="get" data-from="home" data-pk="{{ post.pk }}">
                            <div class="col s4 m4 l4 center">
                                <a class="btn-flat red white-text modal-trigger" href="#delete-post-modal"><i class="material-icons">delete</i></a>
                            </div>

                            {# Delete post modal #}

                            <div id="delete-post-modal" class="modal modal-fixed-footer">
                                <div class="modal-content">
                                  <h4>Delete Post</h4>
                                  <p>Do you really want to delete this? There is no going back...</p>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn-flat post-del-btn-no green white-text" type="submit">
                                        No
                                    </button>
                                    <button class="btn-flat red white-text" type="submit">
                                        Yes
                                    </button>
                                </div>
                            </div>
                        </form>


                    {% else %}
                        <div class="col s6 m6 l6 center">
                            <a class="btn-flat like-btn light-blue white-text" data-href="{% url 'like_api_toggle' post.slug %}" data-likes="{{ post.likes.count }}" href="{% url 'like_toggle' post.slug %}">
                                {{ post.likes.count }}
                                <i class="material-icons large">thumb_up</i>
                            </a>
                        </div>
                        <div class="col s6 m6 l6 center">
                            <a class="btn-flat comment-display-btn light-blue white-text" href="#">
                                <i class="material-icons large">comment</i>
                            </a>
                        </div>
                    {% endif %}
                </li>
                <li class="collection-item comment-display" > {# style="display: none;"> #}
                        {% if user.is_authenticated %}
                            <form method="post" action="{% url 'Add Comment' post.id %}">
                                {% csrf_token %}
                                {{ comment_form|materializecss }}
                                <button class="btn waves-light" type="submit" name="action">Post Comment
                                    <i class="material-icons right">send</i>
                                </button>
                            </form>
                        {% endif %}
                            {% for comment in comments %}
                                {% if comment.post.id == post.id %}
                                    <blockquote id="comment-{{ post.pk }}-{{ comment.pk }}">
                                    {{ comment.comment_text }}
                                        <footer>
                                        via -
                                            <a class="chip" href="{% url 'User Profile' comment.user.username %} ">
                                                {% for user_profile in user_profiles %}
                                                    {% if user_profile.user == comment.user %}
                                                        {% if user_profile.avatar %}
                                                            <img src="{{ user_profile.avatar.url }}">
                                                        {% else %}
                                                            <img src="{% static 'default-profile-picture.jpg' %}">
                                                        {% endif %}
                                                    {% endif %}
                                                {% endfor %}
                                                {{ comment.user }}
                                            </a>
                                                | {{ comment.timestamp|timesince }} ago |
                                                {% if comment.children.count > 1 %}
                                                    {{ comment.children.count }} Replies |
                                                {% elif comment.children.count == 1 %}
                                                    {{ comment.children.count }} Reply |
                                                {% endif %}
                                                <a class="comment-reply-btn" href="#">Reply</a>
                                        </footer>

                                        <div class="comment-reply" style="display: none;">
                                            {% for child_comment in comment.children %}
                                                <blockquote>
                                                {{ child_comment.comment_text }}
                                                    <footer>
                                                    via -
                                                        <a class="chip" href="{% url 'User Profile' child_comment.user.username %} ">
                                                            {% for user_profile in user_profiles %}
                                                                {% if user_profile.user == child_comment.user %}
                                                                    {% if user_profile.avatar %}
                                                                        <img src="{{ user_profile.avatar.url }}">
                                                                    {% else %}
                                                                        <img src="{% static 'default-profile-picture.jpg' %}">
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% endfor %}
                                                            {{ child_comment.user }}
                                                        </a>
                                                        <span id="comment-timestamp" style="color: #0f74a8;">
                                                            | {{ child_comment.timestamp|timesince }} ago
                                                        </span>
                                                    </footer>

                                                </blockquote>
                                            {% endfor %}
                                            {% if user.is_authenticated %}
                                                <form method="post" action="{% url 'Add Comment' post.id %}">
                                                    {% csrf_token %}
                                                    {{ comment_form|materializecss }}
                                                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                                                    <button class="btn waves-light" type="submit" name="action">Reply
                                                        <i class="material-icons right">send</i>
                                                    </button>
                                                </form>
                                            {% endif %}
                                        </div>
                                    </blockquote>
                                    <div class="divider"></div>
                                {% endif %}
                            {% endfor %}
                </li>
        {#      <li class="collection-item">#}
        {#      Share to:#}
        {#      <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}">Facebook</a>#}
        {#      </li>#}
            </ul>
        {% endif %}
    {% endfor %}
</div>
{% else %}
    <div class="normal-post">
    <ul class="collection no-post-yet">
        <li class="collection-item">
            There isn't any post to show yet.
        </li>
    </ul>
    </div>

{% endif %}
{# Pagination #}
{% include 'home/pagination_home.html' %}
{# Pagination Ended #}